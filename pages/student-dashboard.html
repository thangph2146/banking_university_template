<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý sự kiện - Đại Học Ngân Hàng TP.HCM</title>
    <link rel="icon" href="../favicon.svg" type="image/svg+xml">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <meta name="description" content="Quản lý sự kiện đã đăng ký và lịch sử tham gia tại Đại học Ngân hàng TP.HCM">
</head>
<body>
    <!-- Header -->
    <header class="unified-header">
        <div class="container">
            <a href="../index.html" class="unified-logo">
                <img src="../images/logo/logo.svg" alt="Logo Đại học Ngân hàng TP.HCM">
                <span>Đại học Ngân hàng TP.HCM</span>
            </a>
            
            <div class="unified-nav">
                <ul class="unified-nav-list">
                    <li><a href="../index.html"><i class="fas fa-home"></i> Trang chủ</a></li>
                    <li><a href="events.html"><i class="fas fa-calendar-alt"></i> Sự kiện</a></li>
                    <li><a href="event-category.html"><i class="fas fa-tag"></i> Danh mục</a></li>
                    <li><a href="about.html"><i class="fas fa-info-circle"></i> Giới thiệu</a></li>
                    <li><a href="#"><i class="fas fa-newspaper"></i> Tin tức</a></li>
                </ul>
            </div>
            
            <div class="unified-search">
                <input type="text" placeholder="Tìm kiếm sự kiện...">
                <button type="button"><i class="fas fa-search"></i></button>
            </div>
            
            <div class="unified-auth-buttons">
                <!-- This will be replaced by user dropdown via JavaScript -->
            </div>
            
            <button class="hamburger-menu">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>
    
    <!-- Mobile Nav -->
    <div class="mobile-nav">
        <ul class="mobile-nav-list">
            <li><a href="../index.html"><i class="fas fa-home"></i> Trang chủ</a></li>
            <li><a href="events.html"><i class="fas fa-calendar-alt"></i> Sự kiện</a></li>
            <li><a href="event-category.html"><i class="fas fa-tag"></i> Danh mục</a></li>
            <li><a href="about.html"><i class="fas fa-info-circle"></i> Giới thiệu</a></li>
            <li><a href="#"><i class="fas fa-newspaper"></i> Tin tức</a></li>
        </ul>
        <div class="unified-search">
            <input type="text" placeholder="Tìm kiếm sự kiện...">
            <button type="button"><i class="fas fa-search"></i></button>
        </div>
        <div class="unified-auth-buttons">
            <!-- This will be replaced by user dropdown via JavaScript -->
        </div>
    </div>

    <!-- Dashboard Section -->
    <section class="dashboard-section">
        <div class="container">
            <!-- Breadcrumb -->
            <div class="breadcrumb-container fade-in">
                <ul class="breadcrumb">
                    <li><a href="../index.html">Trang chủ</a></li>
                    <li>Quản lý sự kiện</li>
                </ul>
            </div>
            
            <div class="dashboard-container">
                <!-- Sidebar -->
                <div class="dashboard-sidebar fade-in-left">
                    <div class="user-profile">
                        <div class="user-avatar">
                            <img src="https://placehold.co/150x150" alt="Avatar" id="userAvatar">
                            <div class="avatar-edit">
                                <label for="avatarUpload">
                                    <i class="fas fa-camera"></i>
                                </label>
                                <input type="file" id="avatarUpload" accept="image/*" style="display: none;">
                            </div>
                        </div>
                        <div class="user-info">
                            <h3 id="userName">Nguyễn Văn A</h3>
                            <p id="userEmail">student@buh.edu.vn</p>
                        </div>
                    </div>
                    
                    <div class="dashboard-nav">
                        <ul>
                            <li class="active">
                                <a href="student-dashboard.html">
                                    <i class="fas fa-tachometer-alt"></i>
                                    <span>Tổng quan</span>
                                </a>
                            </li>
                            <li>
                                <a href="student-events.html">
                                    <i class="fas fa-calendar-check"></i>
                                    <span>Sự kiện của tôi</span>
                                </a>
                            </li>
                            <li>
                                <a href="student-saved.html">
                                    <i class="fas fa-bookmark"></i>
                                    <span>Sự kiện đã lưu</span>
                                </a>
                            </li>
                            <li>
                                <a href="profile.html">
                                    <i class="fas fa-user"></i>
                                    <span>Hồ sơ cá nhân</span>
                                </a>
                            </li>
                            <li>
                                <a href="student-certificates.html">
                                    <i class="fas fa-certificate"></i>
                                    <span>Chứng chỉ</span>
                                </a>
                            </li>
                            <li>
                                <a href="student-settings.html">
                                    <i class="fas fa-cog"></i>
                                    <span>Cài đặt</span>
                                </a>
                            </li>
                            <li>
                                <a href="#" id="logoutBtn">
                                    <i class="fas fa-sign-out-alt"></i>
                                    <span>Đăng xuất</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <!-- Main Content -->
                <div class="dashboard-main fade-in-right">
                    <div class="dashboard-header">
                        <h1>Quản lý sự kiện</h1>
                        <p>Xin chào, <span id="welcomeUserName">Nguyễn Văn A</span>! Quản lý các sự kiện của bạn tại đây.</p>
                    </div>
                    
                    <!-- Dashboard Stats -->
                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="registeredCount">0</h3>
                                <p>Sự kiện đã đăng ký</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-calendar-day"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="upcomingCount">0</h3>
                                <p>Sự kiện sắp diễn ra</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-history"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="pastCount">0</h3>
                                <p>Sự kiện đã tham gia</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">
                                <i class="fas fa-certificate"></i>
                            </div>
                            <div class="stat-content">
                                <h3 id="certificateCount">0</h3>
                                <p>Chứng chỉ</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dashboard Tabs -->
                    <div class="dashboard-tabs-container">
                        <div class="dashboard-tabs">
                            <button class="dashboard-tab active" data-tab="registered">Đã đăng ký</button>
                            <button class="dashboard-tab" data-tab="upcoming">Sắp diễn ra</button>
                            <button class="dashboard-tab" data-tab="history">Lịch sử tham gia</button>
                        </div>
                        
                        <!-- Registered Events Tab -->
                        <div class="dashboard-tab-content active" id="registered">
                            <div class="tab-header">
                                <h2>Sự kiện đã đăng ký</h2>
                                <div class="tab-actions">
                                    <div class="search-box">
                                        <input type="text" placeholder="Tìm kiếm sự kiện..." id="registeredSearch">
                                        <button><i class="fas fa-search"></i></button>
                                    </div>
                                    <select id="registeredSort">
                                        <option value="date-asc">Ngày tăng dần</option>
                                        <option value="date-desc">Ngày giảm dần</option>
                                        <option value="name-az">Tên A-Z</option>
                                        <option value="name-za">Tên Z-A</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="events-table-container">
                                <table class="events-table" id="registeredTable">
                                    <thead>
                                        <tr>
                                            <th>Sự kiện</th>
                                            <th>Ngày</th>
                                            <th>Thời gian</th>
                                            <th>Địa điểm</th>
                                            <th>Trạng thái</th>
                                            <th>Thao tác</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Events will be loaded dynamically -->
                                    </tbody>
                                </table>
                                
                                <!-- Empty State -->
                                <div class="empty-state" id="registeredEmpty" style="display: none;">
                                    <i class="fas fa-calendar-times"></i>
                                    <h3>Chưa có sự kiện nào</h3>
                                    <p>Bạn chưa đăng ký tham gia sự kiện nào.</p>
                                    <a href="events.html" class="btn btn-primary">Khám phá sự kiện</a>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Upcoming Events Tab -->
                        <div class="dashboard-tab-content" id="upcoming">
                            <div class="tab-header">
                                <h2>Sự kiện sắp diễn ra</h2>
                                <div class="tab-actions">
                                    <div class="search-box">
                                        <input type="text" placeholder="Tìm kiếm sự kiện..." id="upcomingSearch">
                                        <button><i class="fas fa-search"></i></button>
                                    </div>
                                    <select id="upcomingSort">
                                        <option value="date-asc">Ngày tăng dần</option>
                                        <option value="date-desc">Ngày giảm dần</option>
                                        <option value="name-az">Tên A-Z</option>
                                        <option value="name-za">Tên Z-A</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="events-grid" id="upcomingEvents">
                                <!-- Events will be loaded dynamically -->
                            </div>
                            
                            <!-- Empty State -->
                            <div class="empty-state" id="upcomingEmpty" style="display: none;">
                                <i class="fas fa-calendar-day"></i>
                                <h3>Không có sự kiện sắp diễn ra</h3>
                                <p>Hiện tại không có sự kiện nào sắp diễn ra trong thời gian tới.</p>
                                <a href="events.html" class="btn btn-primary">Khám phá sự kiện</a>
                            </div>
                        </div>
                        
                        <!-- History Tab -->
                        <div class="dashboard-tab-content" id="history">
                            <div class="tab-header">
                                <h2>Lịch sử tham gia sự kiện</h2>
                                <div class="tab-actions">
                                    <div class="search-box">
                                        <input type="text" placeholder="Tìm kiếm sự kiện..." id="historySearch">
                                        <button><i class="fas fa-search"></i></button>
                                    </div>
                                    <select id="historySort">
                                        <option value="date-desc">Ngày giảm dần</option>
                                        <option value="date-asc">Ngày tăng dần</option>
                                        <option value="name-az">Tên A-Z</option>
                                        <option value="name-za">Tên Z-A</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="history-timeline" id="historyTimeline">
                                <!-- History will be loaded dynamically -->
                            </div>
                            
                            <!-- Empty State -->
                            <div class="empty-state" id="historyEmpty" style="display: none;">
                                <i class="fas fa-history"></i>
                                <h3>Chưa có lịch sử tham gia</h3>
                                <p>Bạn chưa tham gia sự kiện nào trước đây.</p>
                                <a href="events.html" class="btn btn-primary">Khám phá sự kiện</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Cancel Registration Modal -->
    <div class="modal" id="cancelRegistrationModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Hủy đăng ký tham gia</h2>
                <button class="modal-close"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="cancel-registration-content">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Bạn có chắc chắn muốn hủy đăng ký tham gia sự kiện này?</h3>
                    <p>Sự kiện: <span id="cancelEventName">Hội thảo Khởi nghiệp Công nghệ 2023</span></p>
                    <p>Thời gian: <span id="cancelEventTime">15/12/2023, 9:00 - 11:30</span></p>
                    <p class="warning-text">Lưu ý: Sau khi hủy đăng ký, bạn có thể đăng ký lại nếu sự kiện còn chỗ trống.</p>
                    <div class="modal-actions">
                        <button class="btn btn-danger" id="confirmCancelBtn">Xác nhận hủy</button>
                        <button class="btn btn-outline modal-close-btn">Hủy bỏ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Certificate Modal -->
    <div class="modal" id="certificateModal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2>Chứng chỉ tham gia</h2>
                <button class="modal-close"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <div class="certificate-container">
                    <div class="certificate">
                        <div class="certificate-header">
                            <img src="../images/logo/logo.svg" alt="Logo Đại học Ngân hàng TP.HCM">
                            <h2>CHỨNG NHẬN THAM GIA</h2>
                        </div>
                        <div class="certificate-content">
                            <p>Chứng nhận</p>
                            <h3 id="certificateUserName">Nguyễn Văn A</h3>
                            <p>Đã tham gia sự kiện</p>
                            <h4 id="certificateEventName">Hội thảo Khởi nghiệp Công nghệ 2023</h4>
                            <p>được tổ chức bởi Trường Đại học Ngân hàng TP.HCM</p>
                            <p>vào ngày <span id="certificateEventDate">15/12/2023</span></p>
                        </div>
                        <div class="certificate-footer">
                            <div class="certificate-signature">
                                <img src="https://placehold.co/150x80" alt="Chữ ký">
                                <p>TS. Nguyễn Văn X</p>
                                <p>Hiệu trưởng</p>
                            </div>
                            <div class="certificate-seal">
                                <img src="https://placehold.co/100x100" alt="Con dấu">
                            </div>
                        </div>
                    </div>
                    <div class="certificate-actions">
                        <button class="btn btn-primary" id="downloadCertificateBtn">
                            <i class="fas fa-download"></i> Tải xuống
                        </button>
                        <button class="btn btn-outline" id="shareCertificateBtn">
                            <i class="fas fa-share-alt"></i> Chia sẻ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="unified-footer">
        <div class="container">
            <div class="footer-top">
                <div class="footer-col footer-about">
                    <a href="../index.html" class="footer-logo">
                        <img src="../images/logo/logo.svg" alt="Logo Đại học Ngân hàng TP.HCM">
                    </a>
                    <p>Đại học Ngân hàng TP.HCM là trường đại học công lập chuyên đào tạo về lĩnh vực tài chính, ngân hàng hàng đầu tại Việt Nam.</p>
                    <div class="social-links">
                        <a href="#" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                        <a href="#" aria-label="YouTube"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
                <div class="footer-col footer-links">
                    <h3>Liên kết</h3>
                    <ul>
                        <li><a href="../index.html">Trang chủ</a></li>
                        <li><a href="events.html">Sự kiện</a></li>
                        <li><a href="event-category.html">Danh mục</a></li>
                        <li><a href="about.html">Giới thiệu</a></li>
                        <li><a href="#">Tin tức</a></li>
                    </ul>
                </div>
                <div class="footer-col footer-links">
                    <h3>Hỗ trợ</h3>
                    <ul>
                        <li><a href="#">Câu hỏi thường gặp</a></li>
                        <li><a href="#">Điều khoản sử dụng</a></li>
                        <li><a href="#">Chính sách bảo mật</a></li>
                        <li><a href="#">Hướng dẫn đăng ký</a></li>
                        <li><a href="#">Liên hệ hỗ trợ</a></li>
                    </ul>
                </div>
                <div class="footer-col footer-contact">
                    <h3>Liên hệ</h3>
                    <p><i class="fas fa-map-marker-alt"></i> 36 Tôn Thất Đạm, Phường Nguyễn Thái Bình, Quận 1, TP.HCM</p>
                    <p><i class="fas fa-phone-alt"></i> (028) 3829 1901</p>
                    <p><i class="fas fa-envelope"></i> info@buh.edu.vn</p>
                </div>
            </div>
            <div class="footer-bottom">
                <div class="copyright">
                    <p>&copy; 2023 Đại học Ngân hàng TP.HCM. Tất cả quyền được bảo lưu.</p>
                </div>
            </div>
        </div>
        
        <button id="backToTop" class="back-to-top">
            <i class="fas fa-arrow-up"></i>
        </button>
    </footer>

    <!-- Loading Spinner -->
    <div class="spinner-overlay">
        <div class="spinner"></div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container"></div>

    <script src="../js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in
            const user = JSON.parse(localStorage.getItem('user'));
            
            if (!user) {
                // Redirect to login page if not logged in
                window.location.href = 'login.html';
                return;
            }
            
            // Update user information
            document.getElementById('userName').textContent = user.name || 'Người dùng';
            document.getElementById('userEmail').textContent = user.email || '';
            document.getElementById('welcomeUserName').textContent = user.name || 'Người dùng';
            
            // Get registrations from localStorage
            const registrations = JSON.parse(localStorage.getItem('registrations')) || [];
            
            // Sample event data (in a real application, this would come from an API)
            const allEvents = [
                {
                    id: 1,
                    title: 'Hội thảo Khởi nghiệp Công nghệ 2023',
                    category: 'academic',
                    categoryLabel: 'Học thuật',
                    categoryIcon: 'graduation-cap',
                    date: '2023-12-15',
                    day: '15',
                    month: 'Th12',
                    time: '9:00 - 11:30',
                    location: 'Hội trường A',
                    description: 'Khám phá những xu hướng mới nhất trong lĩnh vực công nghệ tài chính và ứng dụng trong ngành ngân hàng hiện đại.',
                    image: 'https://picsum.photos/id/28/800/500',
                    status: 'upcoming' // upcoming, ongoing, completed
                },
                {
                    id: 2,
                    title: 'Ngày hội việc làm 2023',
                    category: 'career',
                    categoryLabel: 'Việc làm',
                    categoryIcon: 'briefcase',
                    date: '2023-12-20',
                    day: '20',
                    month: 'Th12',
                    time: '8:30 - 16:00',
                    location: 'Sảnh Trung tâm',
                    description: 'Cơ hội để sinh viên gặp gỡ và giao lưu với hơn 50 doanh nghiệp hàng đầu. Mang theo CV và sẵn sàng cho các buổi phỏng vấn trực tiếp.',
                    image: 'https://picsum.photos/id/201/800/500',
                    status: 'upcoming'
                },
                {
                    id: 3,
                    title: 'Workshop: Đàm phán trong Kinh doanh',
                    category: 'workshop',
                    categoryLabel: 'Hội thảo',
                    categoryIcon: 'chalkboard-teacher',
                    date: '2023-12-22',
                    day: '22',
                    month: 'Th12',
                    time: '14:00 - 17:00',
                    location: 'Phòng hội thảo B',
                    description: 'Học hỏi các kỹ năng đàm phán thiết yếu từ các chuyên gia hàng đầu trong lĩnh vực kinh doanh và tài chính.',
                    image: 'https://picsum.photos/id/180/800/500',
                    status: 'upcoming'
                },
                {
                    id: 4,
                    title: 'Đêm nhạc Chào đón Năm mới 2024',
                    category: 'cultural',
                    categoryLabel: 'Văn hóa',
                    categoryIcon: 'music',
                    date: '2023-12-25',
                    day: '25',
                    month: 'Th12',
                    time: '18:00 - 22:00',
                    location: 'Sân trường',
                    description: 'Thưởng thức âm nhạc và các tiết mục nghệ thuật đặc sắc để chào đón năm mới cùng cộng đồng sinh viên.',
                    image: 'https://picsum.photos/id/119/800/500',
                    status: 'upcoming'
                },
                {
                    id: 5,
                    title: 'Cuộc thi Ý tưởng Kinh doanh 2024',
                    category: 'competition',
                    categoryLabel: 'Cuộc thi',
                    categoryIcon: 'trophy',
                    date: '2024-01-05',
                    day: '05',
                    month: 'Th1',
                    time: '9:00 - 17:00',
                    location: 'Hội trường lớn',
                    description: 'Trình bày ý tưởng kinh doanh sáng tạo của bạn và có cơ hội nhận được vốn đầu tư từ các nhà đầu tư thiên thần.',
                    image: 'https://picsum.photos/id/26/800/500',
                    status: 'upcoming'
                },
                {
                    id: 6,
                    title: 'Giải Bóng đá BUH Cup 2024',
                    category: 'sports',
                    categoryLabel: 'Thể thao',
                    categoryIcon: 'futbol',
                    date: '2024-01-10',
                    day: '10',
                    month: 'Th1',
                    time: '8:00 - 17:00',
                    location: 'Sân vận động trường',
                    description: 'Giải đấu bóng đá thường niên với sự tham gia của các đội đến từ các khoa và đơn vị trong trường.',
                    image: 'https://picsum.photos/id/171/800/500',
                    status: 'upcoming'
                },
                {
                    id: 7,
                    title: 'Seminar: Blockchain trong Ngành Tài chính',
                    category: 'academic',
                    categoryLabel: 'Học thuật',
                    categoryIcon: 'graduation-cap',
                    date: '2024-01-15',
                    day: '15',
                    month: 'Th1',
                    time: '14:00 - 16:30',
                    location: 'Phòng 301',
                    description: 'Khám phá tiềm năng của công nghệ blockchain trong lĩnh vực tài chính và ngân hàng với các chuyên gia hàng đầu.',
                    image: 'https://picsum.photos/id/140/800/500',
                    status: 'upcoming'
                },
                {
                    id: 8,
                    title: 'Hội thảo Kỹ năng Mềm cho Sinh viên',
                    category: 'workshop',
                    categoryLabel: 'Hội thảo',
                    categoryIcon: 'chalkboard-teacher',
                    date: '2023-11-20',
                    day: '20',
                    month: 'Th11',
                    time: '9:00 - 12:00',
                    location: 'Phòng hội thảo C',
                    description: 'Phát triển các kỹ năng mềm cần thiết cho sinh viên như giao tiếp, làm việc nhóm, quản lý thời gian và giải quyết vấn đề.',
                    image: 'https://picsum.photos/id/48/800/500',
                    status: 'completed',
                    attendance: true,
                    certificate: true
                },
                {
                    id: 9,
                    title: 'Triển lãm Nghệ thuật Sinh viên',
                    category: 'cultural',
                    categoryLabel: 'Văn hóa',
                    categoryIcon: 'palette',
                    date: '2023-11-25',
                    day: '25',
                    month: 'Th11',
                    time: '10:00 - 18:00',
                    location: 'Thư viện',
                    description: 'Triển lãm các tác phẩm nghệ thuật của sinh viên từ các khoa khác nhau, thể hiện tài năng và sáng tạo của sinh viên.',
                    image: 'https://picsum.photos/id/96/800/500',
                    status: 'completed',
                    attendance: true,
                    certificate: false
                },
                {
                    id: 10,
                    title: 'Hội thảo Tài chính Quốc tế',
                    category: 'academic',
                    categoryLabel: 'Học thuật',
                    categoryIcon: 'graduation-cap',
                    date: '2023-10-01',
                    day: '01',
                    month: 'Th10',
                    time: '9:00 - 16:00',
                    location: 'Hội trường A',
                    description: 'Hội thảo quốc tế về các xu hướng và thách thức trong lĩnh vực tài chính toàn cầu với sự tham gia của các chuyên gia quốc tế.',
                    image: 'https://picsum.photos/id/160/800/500',
                    status: 'completed',
                    attendance: true,
                    certificate: true
                }
            ];
            
            // Get registered events
            const registeredEventIds = registrations.map(reg => reg.eventId);
            const registeredEvents = allEvents.filter(event => registeredEventIds.includes(event.id));
            
            // Get upcoming events (events with status 'upcoming')
            const upcomingEvents = allEvents.filter(event => event.status === 'upcoming');
            
            // Get past events (events with status 'completed')
            const pastEvents = allEvents.filter(event => event.status === 'completed');
            
            // Update stats
            document.getElementById('registeredCount').textContent = registeredEvents.length;
            document.getElementById('upcomingCount').textContent = upcomingEvents.length;
            document.getElementById('pastCount').textContent = pastEvents.length;
            document.getElementById('certificateCount').textContent = pastEvents.filter(event => event.certificate).length;
            
            // Populate registered events table
            populateRegisteredEvents(registeredEvents);
            
            // Populate upcoming events grid
            populateUpcomingEvents(upcomingEvents);
            
            // Populate history timeline
            populateHistoryTimeline(pastEvents);
            
            // Tab switching
            const tabs = document.querySelectorAll('.dashboard-tab');
            const tabContents = document.querySelectorAll('.dashboard-tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    tabs.forEach(t => t.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // Hide all tab contents
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // Show corresponding tab content
                    const tabId = this.getAttribute('data-tab');
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', function(e) {
                e.preventDefault();
                
                // Clear user data
                localStorage.removeItem('user');
                
                // Show success toast
                showToast('success', 'Đăng xuất thành công', 'Bạn đã đăng xuất khỏi hệ thống.');
                
                // Redirect to home page after 1 second
                setTimeout(function() {
                    window.location.href = '../index.html';
                }, 1000);
            });
            
            // Avatar upload
            document.getElementById('avatarUpload').addEventListener('change', function(e) {
                const file = e.target.files[0];
                
                if (file) {
                    const reader = new FileReader();
                    
                    reader.onload = function(e) {
                        document.getElementById('userAvatar').src = e.target.result;
                        
                        // In a real app, you would upload the image to a server
                        // For this template, we'll just store it in localStorage
                        const user = JSON.parse(localStorage.getItem('user'));
                        user.avatar = e.target.result;
                        localStorage.setItem('user', JSON.stringify(user));
                        
                        showToast('success', 'Cập nhật thành công', 'Ảnh đại diện đã được cập nhật.');
                    };
                    
                    reader.readAsDataURL(file);
                }
            });
            
            // Search functionality for registered events
            document.getElementById('registeredSearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const filteredEvents = registeredEvents.filter(event => 
                    event.title.toLowerCase().includes(searchTerm) || 
                    event.location.toLowerCase().includes(searchTerm) ||
                    event.categoryLabel.toLowerCase().includes(searchTerm)
                );
                
                populateRegisteredEvents(filteredEvents);
            });
            
            // Sort functionality for registered events
            document.getElementById('registeredSort').addEventListener('change', function() {
                const sortValue = this.value;
                let sortedEvents = [...registeredEvents];
                
                if (sortValue === 'date-asc') {
                    sortedEvents.sort((a, b) => new Date(a.date) - new Date(b.date));
                } else if (sortValue === 'date-desc') {
                    sortedEvents.sort((a, b) => new Date(b.date) - new Date(a.date));
                } else if (sortValue === 'name-az') {
                    sortedEvents.sort((a, b) => a.title.localeCompare(b.title));
                } else if (sortValue === 'name-za') {
                    sortedEvents.sort((a, b) => b.title.localeCompare(a.title));
                }
                
                populateRegisteredEvents(sortedEvents);
            });
            
            // Search functionality for upcoming events
            document.getElementById('upcomingSearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const filteredEvents = upcomingEvents.filter(event => 
                    event.title.toLowerCase().includes(searchTerm) || 
                    event.location.toLowerCase().includes(searchTerm) ||
                    event.categoryLabel.toLowerCase().includes(searchTerm)
                );
                
                populateUpcomingEvents(filteredEvents);
            });
            
            // Sort functionality for upcoming events
            document.getElementById('upcomingSort').addEventListener('change', function() {
                const sortValue = this.value;
                let sortedEvents = [...upcomingEvents];
                
                if (sortValue === 'date-asc') {
                    sortedEvents.sort((a, b) => new Date(a.date) - new Date(b.date));
                } else if (sortValue === 'date-desc') {
                    sortedEvents.sort((a, b) => new Date(b.date) - new Date(a.date));
                } else if (sortValue === 'name-az') {
                    sortedEvents.sort((a, b) => a.title.localeCompare(b.title));
                } else if (sortValue === 'name-za') {
                    sortedEvents.sort((a, b) => b.title.localeCompare(a.title));
                }
                
                populateUpcomingEvents(sortedEvents);
            });
            
            // Search functionality for history
            document.getElementById('historySearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const filteredEvents = pastEvents.filter(event => 
                    event.title.toLowerCase().includes(searchTerm) || 
                    event.location.toLowerCase().includes(searchTerm) ||
                    event.categoryLabel.toLowerCase().includes(searchTerm)
                );
                
                populateHistoryTimeline(filteredEvents);
            });
            
            // Sort functionality for history
            document.getElementById('historySort').addEventListener('change', function() {
                const sortValue = this.value;
                let sortedEvents = [...pastEvents];
                
                if (sortValue === 'date-asc') {
                    sortedEvents.sort((a, b) => new Date(a.date) - new Date(b.date));
                } else if (sortValue === 'date-desc') {
                    sortedEvents.sort((a, b) => new Date(b.date) - new Date(a.date));
                } else if (sortValue === 'name-az') {
                    sortedEvents.sort((a, b) => a.title.localeCompare(b.title));
                } else if (sortValue === 'name-za') {
                    sortedEvents.sort((a, b) => b.title.localeCompare(a.title));
                }
                
                populateHistoryTimeline(sortedEvents);
            });
            
            // Cancel registration confirmation
            document.getElementById('confirmCancelBtn').addEventListener('click', function() {
                const eventId = parseInt(this.getAttribute('data-event-id'));
                
                // Show loading spinner
                showSpinner();
                
                // Simulate API call
                setTimeout(function() {
                    // Hide spinner
                    hideSpinner();
                    
                    // Remove registration from localStorage
                    let registrations = JSON.parse(localStorage.getItem('registrations')) || [];
                    registrations = registrations.filter(reg => reg.eventId !== eventId);
                    localStorage.setItem('registrations', JSON.stringify(registrations));
                    
                    // Hide modal
                    hideModal('cancelRegistrationModal');
                    
                    // Show success toast
                    showToast('success', 'Hủy đăng ký thành công', 'Bạn đã hủy đăng ký tham gia sự kiện thành công.');
                    
                    // Reload page after 1 second
                    setTimeout(function() {
                        window.location.reload();
                    }, 1000);
                }, 1500);
            });
            
            // Download certificate button
            document.getElementById('downloadCertificateBtn').addEventListener('click', function() {
                // In a real app, this would generate and download a PDF certificate
                // For this template, we'll just show a toast
                showToast('success', 'Tải xuống thành công', 'Chứng chỉ đã được tải xuống.');
            });
            
            // Share certificate button
            document.getElementById('shareCertificateBtn').addEventListener('click', function() {
                // In a real app, this would open a share dialog
                // For this template, we'll just show a toast
                showToast('info', 'Chia sẻ', 'Tính năng chia sẻ chứng chỉ sẽ sớm được cập nhật.');
            });
            
            // Close modals when clicking on close button or outside the modal
            document.querySelectorAll('.modal-close, .modal-close-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    hideModal(modal.id);
                });
            });
            
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        hideModal(this.id);
                    }
                });
            });
        });
        
        // Function to populate registered events table
        function populateRegisteredEvents(events) {
            const tableBody = document.getElementById('registeredTable').querySelector('tbody');
            const emptyState = document.getElementById('registeredEmpty');
            
            if (events.length === 0) {
                tableBody.innerHTML = '';
                emptyState.style.display = 'flex';
                return;
            }
            
            emptyState.style.display = 'none';
            
            let tableHTML = '';
            
            events.forEach(event => {
                const eventDate = new Date(event.date);
                const formattedDate = eventDate.getDate() + '/' + (eventDate.getMonth() + 1) + '/' + eventDate.getFullYear();
                
                let statusHTML = '';
                let actionsHTML = '';
                
                if (event.status === 'upcoming') {
                    statusHTML = '<span class="status-badge upcoming">Sắp diễn ra</span>';
                    actionsHTML = `
                        <button class="btn btn-sm btn-outline" onclick="viewEventDetails(${event.id})">
                            <i class="fas fa-eye"></i> Chi tiết
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="cancelRegistration(${event.id}, '${event.title}', '${formattedDate}, ${event.time}')">
                            <i class="fas fa-times"></i> Hủy
                        </button>
                    `;
                } else if (event.status === 'ongoing') {
                    statusHTML = '<span class="status-badge ongoing">Đang diễn ra</span>';
                    actionsHTML = `
                        <button class="btn btn-sm btn-outline" onclick="viewEventDetails(${event.id})">
                            <i class="fas fa-eye"></i> Chi tiết
                        </button>
                    `;
                } else if (event.status === 'completed') {
                    statusHTML = '<span class="status-badge completed">Đã kết thúc</span>';
                    
                    if (event.certificate) {
                        actionsHTML = `
                            <button class="btn btn-sm btn-outline" onclick="viewEventDetails(${event.id})">
                                <i class="fas fa-eye"></i> Chi tiết
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="viewCertificate(${event.id}, '${event.title}', '${formattedDate}')">
                                <i class="fas fa-certificate"></i> Chứng chỉ
                            </button>
                        `;
                    } else {
                        actionsHTML = `
                            <button class="btn btn-sm btn-outline" onclick="viewEventDetails(${event.id})">
                                <i class="fas fa-eye"></i> Chi tiết
                            </button>
                        `;
                    }
                }
                
                tableHTML += `
                    <tr>
                        <td>
                            <div class="event-info-cell">
                                <div class="event-category-icon ${event.category}">
                                    <i class="fas fa-${event.categoryIcon}"></i>
                                </div>
                                <div class="event-info-content">
                                    <h4>${event.title}</h4>
                                    <span class="event-category">${event.categoryLabel}</span>
                                </div>
                            </div>
                        </td>
                        <td>${formattedDate}</td>
                        <td>${event.time}</td>
                        <td>${event.location}</td>
                        <td>${statusHTML}</td>
                        <td>
                            <div class="table-actions">
                                ${actionsHTML}
                            </div>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
        }
        
        // Function to populate upcoming events grid
        function populateUpcomingEvents(events) {
            const eventsContainer = document.getElementById('upcomingEvents');
            const emptyState = document.getElementById('upcomingEmpty');
            
            if (events.length === 0) {
                eventsContainer.innerHTML = '';
                emptyState.style.display = 'flex';
                return;
            }
            
            emptyState.style.display = 'none';
            
            let eventsHTML = '';
            
            events.forEach(event => {
                eventsHTML += `
                    <div class="event-card fade-in-up">
                        <div class="event-image image-zoom">
                            <span class="event-date">${event.day} <span>${event.month}</span></span>
                            <img src="${event.image}" alt="${event.title}">
                            <div class="event-category-badge ${event.category}">${event.categoryLabel}</div>
                        </div>
                        <div class="event-content">
                            <h3><a href="event-detail.html?id=${event.id}">${event.title}</a></h3>
                            <div class="event-meta">
                                <span><i class="fas fa-calendar-alt"></i> ${event.day}/${event.month}/2023</span>
                                <span><i class="fas fa-map-marker-alt"></i> ${event.location}</span>
                            </div>
                            <p>${event.description}</p>
                            <div class="event-footer">
                                <span class="event-time"><i class="far fa-clock"></i> ${event.time}</span>
                                <a href="event-detail.html?id=${event.id}" class="btn btn-sm btn-primary">Chi tiết</a>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            eventsContainer.innerHTML = eventsHTML;
        }
        
        // Function to populate history timeline
        function populateHistoryTimeline(events) {
            const timelineContainer = document.getElementById('historyTimeline');
            const emptyState = document.getElementById('historyEmpty');
            
            if (events.length === 0) {
                timelineContainer.innerHTML = '';
                emptyState.style.display = 'flex';
                return;
            }
            
            emptyState.style.display = 'none';
            
            let timelineHTML = '';
            
            events.forEach(event => {
                const eventDate = new Date(event.date);
                const formattedDate = eventDate.getDate() + '/' + (eventDate.getMonth() + 1) + '/' + eventDate.getFullYear();
                
                let certificateHTML = '';
                
                if (event.certificate) {
                    certificateHTML = `
                        <button class="btn btn-sm btn-primary" onclick="viewCertificate(${event.id}, '${event.title}', '${formattedDate}')">
                            <i class="fas fa-certificate"></i> Xem chứng chỉ
                        </button>
                    `;
                }
                
                timelineHTML += `
                    <div class="timeline-item fade-in-up">
                        <div class="timeline-date">
                            <span class="day">${event.day}</span>
                            <span class="month">${event.month}</span>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-header">
                                <h3>${event.title}</h3>
                                <span class="event-category-badge ${event.category}">${event.categoryLabel}</span>
                            </div>
                            <div class="timeline-details">
                                <p><i class="fas fa-map-marker-alt"></i> ${event.location}</p>
                                <p><i class="far fa-clock"></i> ${event.time}</p>
                            </div>
                            <div class="timeline-actions">
                                <a href="event-detail.html?id=${event.id}" class="btn btn-sm btn-outline">
                                    <i class="fas fa-eye"></i> Chi tiết
                                </a>
                                ${certificateHTML}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            timelineContainer.innerHTML = timelineHTML;
        }
        
        // Function to view event details
        function viewEventDetails(eventId) {
            window.location.href = `event-detail.html?id=${eventId}`;
        }
        
        // Function to cancel registration
        function cancelRegistration(eventId, eventTitle, eventTime) {
            document.getElementById('cancelEventName').textContent = eventTitle;
            document.getElementById('cancelEventTime').textContent = eventTime;
            document.getElementById('confirmCancelBtn').setAttribute('data-event-id', eventId);
            
            showModal('cancelRegistrationModal');
        }
        
        // Function to view certificate
        function viewCertificate(eventId, eventTitle, eventDate) {
            const user = JSON.parse(localStorage.getItem('user'));
            
            document.getElementById('certificateUserName').textContent = user.name || 'Người dùng';
            document.getElementById('certificateEventName').textContent = eventTitle;
            document.getElementById('certificateEventDate').textContent = eventDate;
            
            showModal('certificateModal');
        }
        
        // Function to show modal
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.classList.add('modal-open');
            }
        }
        
        // Function to hide modal
        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                document.body.classList.remove('modal-open');
            }
        }
        
        // Function to show spinner
        function showSpinner() {
            document.querySelector('.spinner-overlay').classList.add('active');
        }
        
        // Function to hide spinner
        function hideSpinner() {
            document.querySelector('.spinner-overlay').classList.remove('active');
        }
        
        // Function to show toast
        function showToast(type, title, message) {
            const toastContainer = document.querySelector('.toast-container');
            
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            // Set icon based on type
            let icon = '';
            switch (type) {
                case 'success':
                    icon = 'fa-check-circle';
                    break;
                case 'error':
                    icon = 'fa-exclamation-circle';
                    break;
                case 'info':
                    icon = 'fa-info-circle';
                    break;
                case 'warning':
                    icon = 'fa-exclamation-triangle';
                    break;
            }
            
            // Create toast content
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas ${icon}"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            // Add toast to container
            toastContainer.appendChild(toast);
            
            // Add close event listener
            toast.querySelector('.toast-close').addEventListener('click', function() {
                toast.style.animation = 'slideOut 0.3s forwards';
                setTimeout(function() {
                    toast.remove();
                }, 300);
            });
            
            // Auto remove after 5 seconds
            setTimeout(function() {
                if (toast.parentNode) {
                    toast.style.animation = 'slideOut 0.3s forwards';
                    setTimeout(function() {
                        toast.remove();
                    }, 300);
                }
            }, 5000);
        }
    </script>
</body>
</html>
